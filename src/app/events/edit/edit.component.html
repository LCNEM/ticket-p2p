<mat-sidenav-container>
  <mat-sidenav></mat-sidenav>
  <mat-sidenav-content>
    <mat-toolbar class="mat-elevation-z4 top-toolbar">
      <button mat-icon-button (click)="global.back()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <span>{{translation.editEvent[global.lang]}}</span>
      <span class="fill-remaining-space"></span>
    </mat-toolbar>
    <div class="mat-typography body-container">
      <mat-spinner *ngIf="loading; else loaded"></mat-spinner>
      <ng-template #loaded>
        <h2>{{translation.editEvent[global.lang]}}</h2>
        <mat-card>
          <form #nameForm="ngForm" (ngSubmit)="changeName()">
            <h3>{{translation.editEvent[global.lang]}}</h3>
            <mat-form-field fxFill>
              <input matInput placeholder="{{translation.eventName[global.lang]}}" [(ngModel)]="forms.name" name="name"
                required />
            </mat-form-field>
            <div fxLayout="row">
              <span class="fill-remaining-space"></span>
              <button mat-raised-button color="accent" [disabled]="nameForm.invalid || name == forms.name">
                {{translation.submit[global.lang]}}
              </button>
            </div>
          </form>
        </mat-card>
        <br />
        <h2>{{translation.capacity[global.lang]}}</h2>
        <mat-card>
          <app-group-list [groups]="groups"></app-group-list>
        </mat-card>
        <br />
        <h2>{{translation.addGroup[global.lang]}}</h2>
        <mat-card>
          <form #capacityForm="ngForm" (ngSubmit)="addCapacity()">
            <div *ngFor="let group of forms.groups; let i = index; let l = last" fxLayout="row">
              <mat-form-field fxFlex="50">
                <input matInput color="accent" placeholder="{{translation.groupName[global.lang]}}" [(ngModel)]="group.name"
                  name="group{{i}}-name" id="group{{i}}-name" required="{{!l || forms.groups.length == 1}}" (focus)="addGroup(i)" />
              </mat-form-field>
              <ng-container *ngIf="!l">
                <mat-form-field class="fill-remaining-space">
                  <input matInput color="accent" type="number" placeholder="{{translation.capacity[global.lang]}}"
                    [(ngModel)]="group.capacity" name="group{{i}}-capacity" required min="1" minlength="1" pattern="[1-9][0-9]*" />
                </mat-form-field>
                <button mat-icon-button color="warn" type="button" (click)="deleteGroup(i)">
                  <mat-icon>clear</mat-icon>
                </button>
              </ng-container>
            </div>
            <div fxLayout="row">
              <span class="fill-remaining-space"></span>
              <button mat-raised-button color="accent" [disabled]="capacityForm.invalid">
                {{translation.submit[global.lang]}}
              </button>
            </div>
          </form>
        </mat-card>
      </ng-template>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>